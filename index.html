<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 1: Nature of Science</title>
    <link rel="stylesheet" href="./shared/styles/common.css" />
    <link rel="stylesheet" href="./shared/styles/lab-styles.css" />
  </head>
  <body>
    <!-- Progress Indicator -->
    <div
      class="progress-indicator"
      style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 8px 0;
      "
    >
      <div
        class="progress-bar"
        style="width: 100%; height: 8px; background: #e0e0e0; overflow: hidden"
      >
        <div
          class="progress-fill"
          id="progressFill"
          style="
            height: 8px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: block;
          "
        ></div>
      </div>
    </div>

    <div class="container">
      <div class="header">
        <h1>üìö Lab 1: The Nature of Science</h1>
        <p>Understanding Scientific Principles and Methods (30 Points)</p>
      </div>

      <div class="content">
        <!-- For this Lab Section -->
        <div class="section">
          <h2>üìã For This Lab</h2>
          <div
            class="info-box"
            style="
              background: #e3f2fd;
              border-left: 4px solid #2196f3;
              padding: 20px;
              border-radius: 8px;
              margin-bottom: 25px;
            "
          >
            <h3
              style="
                margin-top: 0;
                margin-bottom: 15px;
                color: #1976d2;
                font-size: 1.1em;
              "
            >
              Instructions
            </h3>
            <ol style="margin: 0; padding-left: 25px; line-height: 2">
              <li>Read the required chapter before beginning</li>
              <li>Answer all six questions in the text boxes provided</li>
              <li>
                Monitor your progress using the progress bar at the top of the
                page
              </li>
              <li>Your work is automatically saved as you type</li>
              <li>
                When complete, click
                <strong>"Download file for Canvas Submission"</strong>
              </li>
              <li>
                Locate the downloaded file (<em>Lab01_NatureOfScience.txt</em>)
                and upload it to Canvas
              </li>
            </ol>
            <p
              style="
                margin-top: 15px;
                margin-bottom: 0;
                font-size: 0.95em;
                color: #555;
              "
            >
              <strong>üí° Tip:</strong> Each question requires a minimum of 20
              characters. Take your time to provide thoughtful, complete
              responses.
            </p>
          </div>
        </div>

        <!-- Introduction Section -->
        <div class="section">
          <h2>üìñ Introduction</h2>
          <div class="intro-box">
            <p>
              This lab explores the fundamental principles of scientific inquiry
              and methodology. You'll examine the assumptions scientists make,
              how scientific knowledge is validated, and the ethical
              considerations that guide scientific research.
            </p>
            <p>
              <strong>Required Reading:</strong> Before answering the questions,
              please read the chapter:
              <a
                href="http://www.project2061.org/publications/sfaa/online/chap1.htm"
                target="_blank"
              >
                Science for All Americans - Chapter 1
              </a>
            </p>
          </div>
        </div>

        <form id="questionForm">
          <div class="section">
            <h3>Question 1: Assumptions in Science (6 pts)</h3>
            <div class="form-group">
              <label for="q1a">Assumption 1: (3 pts)</label>
              <textarea
                id="q1a"
                placeholder="Enter first assumption here..."
              ></textarea>
            </div>
            <div class="form-group">
              <label for="q1b">Assumption 2: (3 pts)</label>
              <textarea
                id="q1b"
                placeholder="Enter second assumption here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 2: Scientific Method (3 pts)</h3>
            <div class="form-group">
              <label for="q2"
                >What are the fixed steps of science that scientists always
                follow?</label
              >
              <textarea
                id="q2"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 3: Testing Past Events (3 pts)</h3>
            <div class="form-group">
              <label for="q3"
                >Since scientific ideas are often validated by making
                predictions about future events, how can scientists test or
                validate ideas about events that happened in the past?</label
              >
              <textarea
                id="q3"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 4: Minimizing Bias (6 pts)</h3>
            <div class="form-group">
              <label for="q4a"
                >How might a scientist introduce bias into their data
                unintentionally? (3 pts)</label
              >
              <textarea
                id="q4a"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
            <div class="form-group">
              <label for="q4b"
                >What is one strategy scientists can use to minimize bias in
                their work? (3 pts)</label
              >
              <textarea
                id="q4b"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 5: Science and Authority (6 pts)</h3>
            <div class="form-group">
              <label for="q5a"
                >What does it mean to say that science is not based on
                authority? (3 pts)</label
              >
              <textarea
                id="q5a"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
            <div class="form-group">
              <label for="q5b"
                >How does this affect the way scientific knowledge is accepted
                or challenged? (3 pts)</label
              >
              <textarea
                id="q5b"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 6: Ethical Challenges (6 pts)</h3>
            <div class="form-group">
              <label for="q6a">Ethical Challenge 1: (3 pts)</label>
              <textarea
                id="q6a"
                placeholder="Identify and explain first ethical challenge..."
              ></textarea>
            </div>
            <div class="form-group">
              <label for="q6b">Ethical Challenge 2: (3 pts)</label>
              <textarea
                id="q6b"
                placeholder="Identify and explain second ethical challenge..."
              ></textarea>
            </div>
          </div>

          <div
            class="button-container"
            style="
              display: flex;
              gap: 10px;
              flex-wrap: wrap;
              justify-content: center;
              margin-top: 30px;
            "
          >
            <button
              type="button"
              class="download-btn"
              onclick="downloadAnswers()"
              style="flex: 1; min-width: 200px"
            >
              üì• Download file for Canvas Submission
            </button>
            <button
              type="button"
              class="clear-btn"
              onclick="clearForm()"
              style="flex: 1; min-width: 200px"
            >
              üóëÔ∏è Clear All Answers
            </button>
            <button
              type="button"
              class="help-btn"
              onclick="window.location.href='mailto:JMartinelli@peru.edu?subject=Lab 1 - Question/Feedback&body=Hi Dr. M,%0D%0A%0D%0AI have a question about Lab 1:%0D%0A%0D%0A'"
              style="
                flex: 1;
                min-width: 200px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 12px 24px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1em;
                font-weight: 600;
                transition: transform 0.2s, box-shadow 0.2s;
              "
              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 16px rgba(102, 126, 234, 0.4)'"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.1)'"
            >
              ‚ùì Questions, concerns, feedback, or need help?
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Update progress indicator based on points
      function updateProgress() {
        let earnedPoints = 0;
        const totalPoints = 30; // 6+3+3+6+6+6 = 30 points
        const questionPoints = {
          q1a: 3,
          q1b: 3, // Q1: 6 pts total (3 each)
          q2: 3, // Q2: 3 pts
          q3: 3, // Q3: 3 pts
          q4a: 3,
          q4b: 3, // Q4: 6 pts total (3 each)
          q5a: 3,
          q5b: 3, // Q5: 6 pts total (3 each)
          q6a: 3,
          q6b: 3, // Q6: 6 pts total (3 each)
        };

        const fields = [
          "q1a",
          "q1b",
          "q2",
          "q3",
          "q4a",
          "q4b",
          "q5a",
          "q5b",
          "q6a",
          "q6b",
        ];

        fields.forEach((field) => {
          const answer = document.getElementById(field).value.trim();
          if (answer) {
            earnedPoints += questionPoints[field];
          }
        });

        const percentage = (earnedPoints / totalPoints) * 100;

        const progressFillElement = document.getElementById("progressFill");

        if (progressFillElement) {
          progressFillElement.style.width = percentage + "%";
        }
      }

      // Load saved answers from localStorage when page loads
      window.addEventListener("load", function () {
        const fields = [
          "q1a",
          "q1b",
          "q2",
          "q3",
          "q4a",
          "q4b",
          "q5a",
          "q5b",
          "q6a",
          "q6b",
        ];
        fields.forEach((field) => {
          const saved = localStorage.getItem(field);
          if (saved) {
            document.getElementById(field).value = saved;
          }
        });
        // Update progress after loading saved values
        updateProgress();
      });

      // Save answers to localStorage as user types
      document.querySelectorAll("textarea").forEach((textarea) => {
        textarea.addEventListener("input", function () {
          localStorage.setItem(this.id, this.value);
          updateProgress();
        });

        // Add validation on blur
        textarea.addEventListener("blur", function () {
          validateTextarea(this);
        });
      });

      function validateTextarea(textarea) {
        const minLength = 20;
        const value = textarea.value.trim();

        // Clear previous errors
        const existingError =
          textarea.parentElement.querySelector(".validation-error");
        if (existingError) {
          existingError.remove();
        }
        textarea.style.borderColor = "";
        textarea.style.backgroundColor = "";

        if (value && value.length < minLength) {
          textarea.style.borderColor = "#dc2626";
          textarea.style.backgroundColor = "#fef2f2";

          const errorDiv = document.createElement("div");
          errorDiv.className = "validation-error";
          errorDiv.style.color = "#dc2626";
          errorDiv.style.fontSize = "0.875rem";
          errorDiv.style.marginTop = "0.25rem";
          errorDiv.textContent =
            "‚ö†Ô∏è Please provide more detail (at least " +
            minLength +
            " characters)";

          textarea.parentElement.appendChild(errorDiv);
          return false;
        }
        return true;
      }

      function downloadAnswers() {
        // Validate all answers before downloading
        let allValid = true;
        const emptyQuestions = [];
        const shortQuestions = [];

        const fields = [
          "q1a",
          "q1b",
          "q2",
          "q3",
          "q4a",
          "q4b",
          "q5a",
          "q5b",
          "q6a",
          "q6b",
        ];

        fields.forEach((field) => {
          const textarea = document.getElementById(field);
          const value = textarea.value.trim();

          if (!value) {
            emptyQuestions.push(field);
            allValid = false;
          } else if (!validateTextarea(textarea)) {
            shortQuestions.push(field);
            allValid = false;
          }
        });

        if (!allValid) {
          let message = "Please complete the following before downloading:\n\n";
          if (emptyQuestions.length > 0) {
            message += "Empty fields: " + emptyQuestions.join(", ") + "\n";
          }
          if (shortQuestions.length > 0) {
            message +=
              "Fields needing more detail: " + shortQuestions.join(", ");
          }
          alert(message);

          // Scroll to first error
          const firstError = document.getElementById(
            emptyQuestions[0] || shortQuestions[0]
          );
          if (firstError) {
            firstError.scrollIntoView({ behavior: "smooth", block: "center" });
          }
          return;
        }

        const answers = [];

        // Header with metadata
        answers.push("LAB: 01");
        answers.push("TITLE: The Nature of Science");
        answers.push("COURSE: ESCI 240");
        answers.push("DATE: " + new Date().toISOString());
        answers.push("TOTAL_POINTS: 30");
        answers.push("=".repeat(70));
        answers.push("");

        // Question 1 - Split format
        answers.push("[QUESTION_1]");
        answers.push("POINTS: 6");
        answers.push("TYPE: split");
        answers.push("PROMPT: List two assumptions in science.");
        answers.push("");
        answers.push("[PART_A]");
        answers.push(document.getElementById("q1a").value.trim());
        answers.push("[/PART_A]");
        answers.push("");
        answers.push("[PART_B]");
        answers.push(document.getElementById("q1b").value.trim());
        answers.push("[/PART_B]");
        answers.push("[/QUESTION_1]");
        answers.push("");

        // Question 2
        answers.push("[QUESTION_2]");
        answers.push("POINTS: 3");
        answers.push("TYPE: essay");
        answers.push(
          "PROMPT: What are the fixed steps of science that scientists always follow?"
        );
        answers.push("");
        answers.push("[ANSWER]");
        answers.push(document.getElementById("q2").value.trim());
        answers.push("[/ANSWER]");
        answers.push("[/QUESTION_2]");
        answers.push("");

        // Question 3
        answers.push("[QUESTION_3]");
        answers.push("POINTS: 3");
        answers.push("TYPE: essay");
        answers.push(
          "PROMPT: Since scientific ideas are often validated by making predictions about future events, how can scientists test or validate ideas about events that happened in the past?"
        );
        answers.push("");
        answers.push("[ANSWER]");
        answers.push(document.getElementById("q3").value.trim());
        answers.push("[/ANSWER]");
        answers.push("[/QUESTION_3]");
        answers.push("");

        // Question 4 - Split format
        answers.push("[QUESTION_4]");
        answers.push("POINTS: 6");
        answers.push("TYPE: split");
        answers.push("PROMPT: Bias in Science");
        answers.push("");
        answers.push("[PART_A]");
        answers.push(
          "How might a scientist introduce bias into their data unintentionally?"
        );
        answers.push("");
        answers.push(document.getElementById("q4a").value.trim());
        answers.push("[/PART_A]");
        answers.push("");
        answers.push("[PART_B]");
        answers.push(
          "What is one strategy scientists can use to minimize bias in their work?"
        );
        answers.push("");
        answers.push(document.getElementById("q4b").value.trim());
        answers.push("[/PART_B]");
        answers.push("[/QUESTION_4]");
        answers.push("");

        // Question 5 - Split format
        answers.push("[QUESTION_5]");
        answers.push("POINTS: 6");
        answers.push("TYPE: split");
        answers.push("PROMPT: Science and Authority");
        answers.push("");
        answers.push("[PART_A]");
        answers.push(
          "What does it mean to say that science is not based on authority?"
        );
        answers.push("");
        answers.push(document.getElementById("q5a").value.trim());
        answers.push("[/PART_A]");
        answers.push("");
        answers.push("[PART_B]");
        answers.push(
          "How does this affect the way scientific knowledge is accepted or challenged?"
        );
        answers.push("");
        answers.push(document.getElementById("q5b").value.trim());
        answers.push("[/PART_B]");
        answers.push("[/QUESTION_5]");
        answers.push("");

        // Question 6 - Split format
        answers.push("[QUESTION_6]");
        answers.push("POINTS: 6");
        answers.push("TYPE: split");
        answers.push(
          "PROMPT: Identify and briefly explain two common ethical challenges that scientists may face in their work."
        );
        answers.push("");
        answers.push("[PART_A]");
        answers.push("Ethical Challenge 1:");
        answers.push("");
        answers.push(document.getElementById("q6a").value.trim());
        answers.push("[/PART_A]");
        answers.push("");
        answers.push("[PART_B]");
        answers.push("Ethical Challenge 2:");
        answers.push("");
        answers.push(document.getElementById("q6b").value.trim());
        answers.push("[/PART_B]");
        answers.push("[/QUESTION_6]");
        answers.push("");

        // Footer
        answers.push("=".repeat(70));
        answers.push("END OF SUBMISSION");

        const blob = new Blob([answers.join("\n")], { type: "text/plain" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "Lab01_NatureOfScience.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        alert("Your answers have been downloaded as a text file!");
      }

      function clearForm() {
        if (
          confirm(
            "Are you sure you want to clear all answers? This cannot be undone."
          )
        ) {
          const fields = [
            "q1a",
            "q1b",
            "q2",
            "q3",
            "q4a",
            "q4b",
            "q5a",
            "q5b",
            "q6a",
            "q6b",
          ];
          fields.forEach((field) => {
            document.getElementById(field).value = "";
            localStorage.removeItem(field);
          });
          updateProgress();
          alert("All answers have been cleared.");
        }
      }
    </script>
  </body>
</html>
