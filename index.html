<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lab 1: Nature of Science</title>
    <link rel="stylesheet" href="./shared/styles/common.css" />
    <link rel="stylesheet" href="./shared/styles/lab-styles.css" />
  </head>
  <body>
    <!-- Progress Indicator -->
    <div
      class="progress-indicator"
      style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 8px 0;
      "
    >
      <div
        class="progress-bar"
        style="width: 100%; height: 8px; background: #e0e0e0; overflow: hidden"
      >
        <div
          class="progress-fill"
          id="progressFill"
          style="
            height: 8px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: block;
          "
        ></div>
      </div>
    </div>

    <div class="container">
      <div class="header">
        <h1>Lab 1: The Nature of Science</h1>
        <p>ESCI 240 - Fall 2025</p>
      </div>

      <div class="content">
        <div class="intro-box">
          <h3>üìö Required Reading</h3>
          <p>Please read the chapter before answering the questions:</p>
          <a
            href="http://www.project2061.org/publications/sfaa/online/chap1.htm"
            target="_blank"
          >
            http://www.project2061.org/publications/sfaa/online/chap1.htm
          </a>
        </div>

        <form id="questionForm">
          <div class="section">
            <h3>Question 1: Assumptions in Science (3 pts)</h3>
            <div class="form-group">
              <label for="q1a">Assumption 1:</label>
              <textarea
                id="q1a"
                placeholder="Enter first assumption here..."
              ></textarea>
            </div>
            <div class="form-group">
              <label for="q1b">Assumption 2:</label>
              <textarea
                id="q1b"
                placeholder="Enter second assumption here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 2: Scientific Method (3 pts)</h3>
            <div class="form-group">
              <label for="q2"
                >What are the fixed steps of science that scientists always
                follow?</label
              >
              <textarea
                id="q2"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 3: Testing Past Events (4 pts)</h3>
            <div class="form-group">
              <label for="q3"
                >Since scientific ideas are often validated by making
                predictions about future events, how can scientists test or
                validate ideas about events that happened in the past?</label
              >
              <textarea
                id="q3"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 4: Minimizing Bias (3 pts)</h3>
            <div class="form-group">
              <label for="q4a">Strategy 1:</label>
              <textarea
                id="q4a"
                placeholder="Enter first strategy here..."
              ></textarea>
            </div>
            <div class="form-group">
              <label for="q4b">Strategy 2:</label>
              <textarea
                id="q4b"
                placeholder="Enter second strategy here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 5: Science and Authority (4 pts)</h3>
            <div class="form-group">
              <label for="q5"
                >What does it mean to say that science is not based on
                authority, and how does this affect the way scientific knowledge
                is accepted or challenged?</label
              >
              <textarea
                id="q5"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="section">
            <h3>Question 6: Ethical Challenges (3 pts)</h3>
            <div class="form-group">
              <label for="q6"
                >Identify and briefly explain two common ethical challenges that
                scientists may face in their work.</label
              >
              <textarea
                id="q6"
                placeholder="Enter your answer here..."
              ></textarea>
            </div>
          </div>

          <div class="button-container">
            <button
              type="button"
              class="download-btn"
              onclick="downloadAnswers()"
            >
              üì• Download Answers as Text File
            </button>
            <button type="button" class="clear-btn" onclick="clearForm()">
              üóëÔ∏è Clear All Answers
            </button>
          </div>
        </form>
      </div>

      <div class="footer">
        <p>
          Save your answers by downloading the text file. Your answers are
          stored locally in your browser.
        </p>
      </div>
    </div>

    <script>
      // Update progress indicator based on points
      function updateProgress() {
        let earnedPoints = 0;
        const totalPoints = 20; // 3+3+4+3+4+3
        const questionPoints = {
          q1a: 1.5,
          q1b: 1.5, // Q1: 3 pts total (1.5 each)
          q2: 3, // Q2: 3 pts
          q3: 4, // Q3: 4 pts
          q4a: 1.5,
          q4b: 1.5, // Q4: 3 pts total (1.5 each)
          q5: 4, // Q5: 4 pts
          q6: 3, // Q6: 3 pts
        };

        const fields = ["q1a", "q1b", "q2", "q3", "q4a", "q4b", "q5", "q6"];

        fields.forEach((field) => {
          const answer = document.getElementById(field).value.trim();
          if (answer) {
            earnedPoints += questionPoints[field];
          }
        });

        const percentage = (earnedPoints / totalPoints) * 100;

        const progressFillElement = document.getElementById("progressFill");

        if (progressFillElement) {
          progressFillElement.style.width = percentage + "%";
        }
      }

      // Load saved answers from localStorage when page loads
      window.addEventListener("load", function () {
        const fields = ["q1a", "q1b", "q2", "q3", "q4a", "q4b", "q5", "q6"];
        fields.forEach((field) => {
          const saved = localStorage.getItem(field);
          if (saved) {
            document.getElementById(field).value = saved;
          }
        });
        // Update progress after loading saved values
        updateProgress();
      });

      // Save answers to localStorage as user types
      document.querySelectorAll("textarea").forEach((textarea) => {
        textarea.addEventListener("input", function () {
          localStorage.setItem(this.id, this.value);
          updateProgress();
        });

        // Add validation on blur
        textarea.addEventListener("blur", function () {
          validateTextarea(this);
        });
      });

      function validateTextarea(textarea) {
        const minLength = 20;
        const value = textarea.value.trim();

        // Clear previous errors
        const existingError =
          textarea.parentElement.querySelector(".validation-error");
        if (existingError) {
          existingError.remove();
        }
        textarea.style.borderColor = "";
        textarea.style.backgroundColor = "";

        if (value && value.length < minLength) {
          textarea.style.borderColor = "#dc2626";
          textarea.style.backgroundColor = "#fef2f2";

          const errorDiv = document.createElement("div");
          errorDiv.className = "validation-error";
          errorDiv.style.color = "#dc2626";
          errorDiv.style.fontSize = "0.875rem";
          errorDiv.style.marginTop = "0.25rem";
          errorDiv.textContent =
            "‚ö†Ô∏è Please provide more detail (at least " +
            minLength +
            " characters)";

          textarea.parentElement.appendChild(errorDiv);
          return false;
        }
        return true;
      }

      function downloadAnswers() {
        // Validate all answers before downloading
        let allValid = true;
        const emptyQuestions = [];
        const shortQuestions = [];

        const fields = ["q1a", "q1b", "q2", "q3", "q4a", "q4b", "q5", "q6"];

        fields.forEach((field) => {
          const textarea = document.getElementById(field);
          const value = textarea.value.trim();

          if (!value) {
            emptyQuestions.push(field);
            allValid = false;
          } else if (!validateTextarea(textarea)) {
            shortQuestions.push(field);
            allValid = false;
          }
        });

        if (!allValid) {
          let message = "Please complete the following before downloading:\n\n";
          if (emptyQuestions.length > 0) {
            message += "Empty fields: " + emptyQuestions.join(", ") + "\n";
          }
          if (shortQuestions.length > 0) {
            message +=
              "Fields needing more detail: " + shortQuestions.join(", ");
          }
          alert(message);

          // Scroll to first error
          const firstError = document.getElementById(
            emptyQuestions[0] || shortQuestions[0]
          );
          if (firstError) {
            firstError.scrollIntoView({ behavior: "smooth", block: "center" });
          }
          return;
        }

        const answers = [];

        // Header with metadata
        answers.push("LAB: 01");
        answers.push("TITLE: The Nature of Science");
        answers.push("COURSE: ESCI 240");
        answers.push("DATE: " + new Date().toISOString());
        answers.push("TOTAL_POINTS: 20");
        answers.push("=".repeat(70));
        answers.push("");

        // Question 1 - Split format
        answers.push("[QUESTION_1]");
        answers.push("POINTS: 3");
        answers.push("TYPE: split");
        answers.push("PROMPT: List two assumptions in science.");
        answers.push("");
        answers.push("[PART_A]");
        answers.push(document.getElementById("q1a").value.trim());
        answers.push("[/PART_A]");
        answers.push("");
        answers.push("[PART_B]");
        answers.push(document.getElementById("q1b").value.trim());
        answers.push("[/PART_B]");
        answers.push("[/QUESTION_1]");
        answers.push("");

        // Question 2
        answers.push("[QUESTION_2]");
        answers.push("POINTS: 3");
        answers.push("TYPE: essay");
        answers.push(
          "PROMPT: What are the fixed steps of science that scientists always follow?"
        );
        answers.push("");
        answers.push("[ANSWER]");
        answers.push(document.getElementById("q2").value.trim());
        answers.push("[/ANSWER]");
        answers.push("[/QUESTION_2]");
        answers.push("");

        // Question 3
        answers.push("[QUESTION_3]");
        answers.push("POINTS: 4");
        answers.push("TYPE: essay");
        answers.push(
          "PROMPT: Since scientific ideas are often validated by making predictions about future events, how can scientists test or validate ideas about events that happened in the past?"
        );
        answers.push("");
        answers.push("[ANSWER]");
        answers.push(document.getElementById("q3").value.trim());
        answers.push("[/ANSWER]");
        answers.push("[/QUESTION_3]");
        answers.push("");

        // Question 4 - Split format
        answers.push("[QUESTION_4]");
        answers.push("POINTS: 3");
        answers.push("TYPE: split");
        answers.push(
          "PROMPT: What are two strategies scientists can use to minimize or prevent personal bias in their research?"
        );
        answers.push("");
        answers.push("[PART_A]");
        answers.push(document.getElementById("q4a").value.trim());
        answers.push("[/PART_A]");
        answers.push("");
        answers.push("[PART_B]");
        answers.push(document.getElementById("q4b").value.trim());
        answers.push("[/PART_B]");
        answers.push("[/QUESTION_4]");
        answers.push("");

        // Question 5
        answers.push("[QUESTION_5]");
        answers.push("POINTS: 4");
        answers.push("TYPE: essay");
        answers.push(
          "PROMPT: What does it mean to say that science is not based on authority, and how does this affect the way scientific knowledge is accepted or challenged?"
        );
        answers.push("");
        answers.push("[ANSWER]");
        answers.push(document.getElementById("q5").value.trim());
        answers.push("[/ANSWER]");
        answers.push("[/QUESTION_5]");
        answers.push("");

        // Question 6
        answers.push("[QUESTION_6]");
        answers.push("POINTS: 3");
        answers.push("TYPE: essay");
        answers.push(
          "PROMPT: Identify and briefly explain two common ethical challenges that scientists may face in their work."
        );
        answers.push("");
        answers.push("[ANSWER]");
        answers.push(document.getElementById("q6").value.trim());
        answers.push("[/ANSWER]");
        answers.push("[/QUESTION_6]");
        answers.push("");

        // Footer
        answers.push("=".repeat(70));
        answers.push("END OF SUBMISSION");

        const blob = new Blob([answers.join("\n")], { type: "text/plain" });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "lab01_nature_of_science_answers.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);

        alert("Your answers have been downloaded as a text file!");
      }

      function clearForm() {
        if (
          confirm(
            "Are you sure you want to clear all answers? This cannot be undone."
          )
        ) {
          const fields = ["q1a", "q1b", "q2", "q3", "q4a", "q4b", "q5", "q6"];
          fields.forEach((field) => {
            document.getElementById(field).value = "";
            localStorage.removeItem(field);
          });
          updateProgress();
          alert("All answers have been cleared.");
        }
      }
    </script>
  </body>
</html>
